<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">

    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />

    <title>Lgbluetooth by DavidSahakyan</title>
  </head>

  <body>

    <header>
      <div class="container">
        <h1>Lgbluetooth</h1>
        <h2>Simple, block-based, lightweight library over CoreBluetooth.</h2>

        <section id="downloads">
          <a href="https://github.com/DavidSahakyan/LGBluetooth/zipball/master" class="btn">Download as .zip</a>
          <a href="https://github.com/DavidSahakyan/LGBluetooth/tarball/master" class="btn">Download as .tar.gz</a>
          <a href="https://github.com/DavidSahakyan/LGBluetooth" class="btn btn-github"><span class="icon"></span>View on GitHub</a>
        </section>
      </div>
    </header>

    <div class="container">
      <section id="main_content">
        <h1>
<a name="lgbluetooth" class="anchor" href="#lgbluetooth"><span class="octicon octicon-link"></span></a>LGBluetooth</h1>

<p>Simple, block-based, lightweight library over CoreBluetooth.</p>

<h2>
<a name="steps-to-start-using" class="anchor" href="#steps-to-start-using"><span class="octicon octicon-link"></span></a>Steps to start using</h2>

<ol>
<li><p>Drag and Drop it into your project</p></li>
<li><p>Import "LGBluetooth.h"</p></li>
<li><p>Star it on github! (It really makes sense)</p></li>
<li><p>You are ready to go!</p></li>
</ol><h2>
<a name="usage" class="anchor" href="#usage"><span class="octicon octicon-link"></span></a>Usage</h2>

<p>For example we have a peripheral which has "5ec0" service, with 3 characteristics
<img src="https://raw2.github.com/DavidSahakyan/LGBluetooth/master/Screenshots/1.PNG" width="320" height="480"><br></p>

<ul>
<li>"cef9" characteristic is writable</li>
<li>"f045" characteristic is readable</li>
<li>"8fdb" characteristic is readable</li>
</ul><pre>
- (IBAction)testPressed:(UIButton *)sender
{
    [[LGCentralManager sharedInstance] scanForPeripheralsByInterval:4
                                                         completion:^(NSArray *peripherals)
     {
         if (peripherals.count) {
             [self testPeripheral:peripherals[0]];
         }
     }];
}

- (void)testPeripheral:(LGPeripheral *)peripheral
{
    [peripheral connectWithCompletion:^(NSError *error) {
        [peripheral discoverServicesWithCompletion:^(NSArray *services, NSError *error) {
            for (LGService *service in services) {
                if ([service.UUIDString isEqualToString:@"5ec0"]) {
                    [service discoverCharacteristicsWithCompletion:^(NSArray *characteristics, NSError *error) {
                        __block int i = 0;
                        for (LGCharacteristic *charact in characteristics) {
                            if ([charact.UUIDString isEqualToString:@"cef9"]) {
                                [charact writeByte:0xFF completion:^(NSError *error) {
                                    if (++i == 3) {
                                        [peripheral disconnectWithCompletion:nil];
                                    }
                                }];
                            } else {
                                [charact readValueWithBlock:^(NSData *data, NSError *error) {
                                    if (++i == 3) {
                                        [peripheral disconnectWithCompletion:nil];
                                    }
                                }];
                            }
                        }
                    }];
                }
            }
        }];
    }];
}
</pre>

<p>After running code we can see the result.</p>

<p><img src="https://raw2.github.com/DavidSahakyan/LGBluetooth/master/Screenshots/5.PNG" width="320" height="480"><br></p>

<p>In this example I'm scanning peripherals for 4 seconds.
After which I am passing first peripheral to test method.</p>

<p>Test method connects to peripheral, discoveres services, discoveres characteristics of "5ec0" service.
Aftter which reads "f045", "8fdb", and writes 0xFF to "cef9" and disconnects from peripheral.</p>

<p>Here is the log from console </p>

<pre>
Connection with error - (null)
Service discovered - Battery
Service discovered - Current Time
Service discovered - Unknown (5ec0)
Characteristic discovered - Unknown (cef9)
Characteristic discovered - Unknown (f045)
Characteristic discovered - Unknown (8fdb)
Characteristic - Unknown (cef9) wrote with error - (null)
Characteristic - Unknown (f045) value - 1234567890 error - 
Characteristic - Unknown (8fdb) value - 11111111111 error - (null)
Disconnect with error - (null)
</pre>

<h2>
<a name="reasons-of-using-lgbluetooth" class="anchor" href="#reasons-of-using-lgbluetooth"><span class="octicon octicon-link"></span></a>Reasons of using LGBluetooth</h2>

<p>As we know CoreBluetooth is very hard to use - 
The methods of objects in Core bluetooth are messy</p>

<p>For example connectPeripheral:options: is written in CBCentralManager,
discoverCharacteristics:forService is written in Peripheral,
writeValue:forCharacteristic:type, readValueForCharacteristic are also in Peripheral</p>

<p>This messy code makes CoreBluetooth development really painfull.
For example if you need to read characteristic value, you need to call "connect" on central object, wait for Central delegate callback,
After that call "discover services", wait peripheral delegate callback, "discover characteristic" which you planned and wait for delegate callback, "readValue" and again wait for delegate callback.
What will happen if your program will make 2 connections at once?
Handling such cases makes messy code, and raises hundred of bugs.</p>

<p>Don't worry, now you can forgot about that hell - LGBluetooth uses blocks for callbacks, you can start using modern code and hierarchical calls.</p>

<h2>
<a name="license" class="anchor" href="#license"><span class="octicon octicon-link"></span></a>LICENSE</h2>

<p>LGBluetooth is under MIT License (see LICENSE file)</p>
      </section>
    </div>

    
  </body>
</html>